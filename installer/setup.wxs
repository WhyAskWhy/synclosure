<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Id$
    $HeadURL$
-->

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

<!--
  The Package element describes the installer (summary properties for the MSI).
  The Product element describes the software that's in the installer.
 -->
 
<!--
FIXME:
    * Dynamically set Version number.
        Thoughts: If dev-svn is found in the version info within build script,
                  have the build script set the value to 0.0.0.X where X is the
                  revision number?
-->

<?include setup.wxi ?>


    <Product
         Id="*"
         Name="$(var.MyAppVerName)"
         Language="1033"
         Version="1.0.0.0"
         Manufacturer="$(var.MyAppPublisher)"
         UpgradeCode="$(var.MyProductUpgradeCode)">

        <Package
            InstallerVersion="301"
            Compressed="yes"
            Manufacturer="$(var.MyAppPublisher)"
            Description="$(var.MyPackageDescription)"
            Comments="$(var.MyPackageComments)" />

        <Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

        <Icon Id="MyAppIcon" SourceFile="synclosure.ico" />

        <!--Setting properties-->
        <Property Id="ARPPRODUCTICON" Value="MyAppIcon" />
        <Property Id="ARPCOMMENTS" Value="$(var.MyAppCopyright)" />
        <Property Id="ARPNOREPAIR" Value="1" />
        <Property Id="ARPCONTACT" Value="$(var.MyAppCurrentMaintainer)" />
        <Property Id="ARPHELPLINK" Value="$(var.MyAppSupportURL)" />
        <Property Id="ARPREADME" Value="$(var.MyAppSupportURL)" />

        <!--Directory structure-->
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFilesFolder">
                <Directory
                     Id="MyProgramDir" Name="$(var.MyAppPublisher)" />
                <Directory Id="ProgramMenuFolder">
                    <Directory
                         Id="MyShortcutsDir" Name="$(var.MyAppPublisher)" />
                </Directory>
            </Directory>
        </Directory>

        <!--Components-->
        <DirectoryRef Id="MyProgramDir">
            <Component
                 Id="CMP_InstallMeTXT"
                 Guid="E8A58B7B-F031-4548-9BDD-7A6796C8460D">
                <File
                     Id="FILE_InstallMeTXT"
                     Source="InstallMe.txt" KeyPath="yes" />
            </Component>
        </DirectoryRef>

        <!--Start Menu Shortcuts-->
        <DirectoryRef Id="MyShortcutsDir">
            <Component Id="CMP_DocumentationShortcut"
                 Guid="33741C82-30BF-41AF-8246-44A5DCFCF953">

                <Shortcut
                     Id="DocumentationStartMenuShortcut"
                     Name="Documentation"
                     Description="Read $(var.MyAppName) Documentation"
                     Target="[MyProgramDir]InstallMe.txt" />

                <Shortcut
                     Id="UninstallShortcut"
                     Name="Uninstall $(var.MyAppName)"
                     Description="Uninstalls $(var.MyAppVerName)"
                     Target="[System64Folder]msiexec.exe"
                     Arguments="/x [ProductCode]" />

                <RemoveFolder
                     Id="RemoveMyShortcutsDir" On="uninstall" />

                <!-- ICE38: Component CMP_DocumentationShortcut installs
                to user profile. It must use a registry key under
                HKCU as its KeyPath, not a file. -->
                <RegistryValue
                     Root="HKCU"
                     Key="$(var.MyAppRegistry)"
                     Name="installed"
                     Type="integer"
                     Value="1"
                     KeyPath="yes" />
            </Component>
        </DirectoryRef>

        <!--Features-->
        <Feature
             Id="ProductFeature" Title="Main Product" Level="1">
            <ComponentRef Id="CMP_InstallMeTXT" />
            <ComponentRef Id="CMP_DocumentationShortcut" />
        </Feature>

        <!--User Interface-->
        <!-- FIXME: Read http://www.tramontana.co.hu/wix/lesson2.php#2.2 -->
        <UIRef Id="WixUI_Minimal" />
        <WixVariable
            Id="WixUILicenseRtf"
            Value="$(var.MyAppLicensePath)" />

    </Product>
</Wix>
